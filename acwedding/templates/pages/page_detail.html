{% extends 'base_content_header_img.html' %}
{% load staticfiles %}
{% load core_tags %}


{% block page_title %}{% block h2 %}{{ page.title }}{% endblock h2 %}{% endblock page_title %}

{% block extra_css %}
    {% if page.has_map %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/gmap.css' %}">
    {% endif %}
    
    {% if page.has_gallery %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/magnific-popup.css' %}">
    {% endif %}
{% endblock extra_css %}

{% block content %}
    {% for section in sections %}
        <section>
            <h3>{{ section.heading }}</h3>
            
            {{ section.content|safe|linebreaks }}
        
            {% with images=section.gallery_images.all %}
                {% if images %}
                    <div class="row popup-gallery">
                        {% for image in images %}
                            <div class="col-md-2 col-sm-2 col-xs-4">
                                <a href="{% static image.static_path %}" class="thumbnail" title="{{ image.caption }}">
                                    <img src="{% static image.thumbnail_path|add:'.thumbnail' %}" alt="{{ image.caption }}" title="{{ image.caption }}">
                                </a>
                            </div>
                    {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
        
        </section>
    {% endfor %}

{% endblock %}

{% block body_end %}   
    {% if page.has_gallery %}
        <script src="{% static 'js/magnificpopup.min.js' %}" type="text/javascript"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                $('.popup-gallery').each( function() {
                    $(this).magnificPopup({
                        delegate: 'div a',
                        type: 'image',
                        tLoading: 'Loading image #%curr%...',
                        mainClass: 'mfp-img-mobile',
                        gallery: {
                            enabled: true,
                            navigateByImgClick: true,
                            preload: [0,1] // Will preload 0 - before current, and 1 after the current image
                        },
                        image: {
                            tError: '<a href="%url%">The image #%curr%</a> could not be loaded.',
                            titleSrc: function(item) {
                                return item.el.attr('title');
                            }
                        }
                    });
                });
            });
        </script>
    {% endif %}
{% endblock body_end %}

