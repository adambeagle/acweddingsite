{% extends 'base.html' %}
{% load staticfiles %}
{% load core_tags %}
{% load googlemaps_tags %}

{% block page_title %}{% block h2 %}{{ page.title }}{% endblock h2 %}{% endblock page_title%}

{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/lightbox.css' %}" />
    {% if has_map %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/gmap.css' %}" />
    {% endif %}
{% endblock extra_css %}

{% block content %}
    {% if subheader_image %}
        <div class="subheader-img-wrapper">
            <img class="img-responsive center-block" src="{% static 'images/subheaders/'|add:subheader_image.filename %}" alt="{{ subheader_image.alt_text }}">
            {% if subheader_image.subtitle %}
                <p class="text-center">{{ subheader_image.subtitle|safe}}</p>
            {% endif %}
        </div>
    {% endif %}
    
    {% for section in section_list %}
        <section>
            <h3>{{ section.heading }}</h3>
            
            {{ section.content|removetags:'script'|safe|urlize|reverseurls|rsttotable|bullets|safe|linebreaks }}
            
            {% for audio in section.sectionaudio_set.all %}
                <span class="block padding-lite"><em>{{ audio.description }}</em></span>
                <audio controls>
                    {% comment %} 
                        !!!!!!!!!!!!!!!!
                        IMPORTANT: It is assumed each audio has .mp3 and .ogg versions with equivalent base filenames.
                        !!!!!!!!!!!!!!!!
                    {% endcomment %}
                    <source src="{% static 'audio/'|add:audio.filename|splitext %}.mp3" type="audio/mpeg">
                    <source src="{% static 'audio/'|add:audio.filename|splitext %}.ogg" type="audio/ogg">
                    <embed height="50" width="100" src="{% static 'audio/'|add:audio.filename|splitext %}.mp3">
                </audio>
            {% endfor %}
            
            {% if section.minigallery %}
                <div class="row">
                    {% for image in section.minigallery.images.all %}
                        <div class="col-md-2 col-sm-2 col-xs-4">
                            <a href="#img{{ image.id }}" class="thumbnail">
                                <img src="{% static 'images/tn/'|add:image.filename|add:'.thumbnail' %}" alt="{{ image.caption }}" title="{{ image.caption }}">
                            </a>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            
            {% if section.map %}
                {% simple_map section.map %}
            {% endif %}
        </section>
    {% endfor %}
{% endblock %}


{% block body_end %}
    {% for section in section_list %}
        {% if section.minigallery %}
            {% for image in section.minigallery.images.all %}
                <a href="#_" class="lightbox" id="img{{ image.id }}">
                    <img src="{% static 'images/minigallery/'|add:image.filename %}">
                    <p>{{ image.caption }}</p>
                </a>
            {% endfor %}
        {% endif %}

    {% endfor %}
{% endblock body_end %}

